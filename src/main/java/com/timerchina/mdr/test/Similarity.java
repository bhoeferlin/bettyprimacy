package com.timerchina.mdr.test;

import java.text.NumberFormat;
import java.util.Locale;


/**
 * 比较两个字符串的相似度
 */

public class Similarity {

	public static void main(String[] args) {		
		String strB = "产品全称 	招商证券智融宝集合资产管理计划,投资范围 	本集合计划投资范围主要为伞形集合信托计划的优先级，在资金闲置期间可配置现金管理类资产等金融监管部门批准或备案发行的金融产品，以及中国证监会认可的其他投资品种。,（1）伞形集合信托计划优先级：占资产总值的 0%－100%；,（2）现金管理类资产：包括现金，存款，通知存款，大额存单，到期日在一年以内（含一年）的国债、央行票据、政策性金融债，期限在一年以内（含一年）的债券逆回购，货币市场基金以及中国证监会认可的其他现金管理类工具：占资产净值的0-100%。,管理期限 	本集合计划的存续期为3年，自本集合计划成立之日起至3年后的对应月对应日止（遇节假日或无对应日的则顺延至下一工作日）。本集合计划存续期满后，可以展期。,目标规模 	本集合计划推广期规模上限为50亿份，存续期规模上限为50亿份。推广期规模上限不含参与资金利息转增份额。,管理人有权根据实际情况调整推广期及存续期规模上限，并在管理人指定网站公告。,集合计划的总参与人数不超过200人。,份额面值 	人民币1.00元。,最低参与金额 	首次参与的最低金额为人民币100万元。管理人可以根据情况设置和调整开放日的最低参与金额，并披露。,开放期 	1、优先级份额开放期安排,开放期安排由管理人根据本集合计划的运作情况在集合计划存续期间灵活设置并确定，于当次开放期委托人参与之前由管理人披露，并披露集合计划优先级份额的期限分类（6个月1期、2期，12个月1期、2期等，以此类推）。 本集合计划可以设置多个开放日，在开放日委托人可参与本计划。委托人在某个开放日参与的计划份额，必须符合管理人在指定网站等形式披露的该份额开放日的参与条件与参与安排，参与条件与参与安排主要包括份额分类情况、份额代码、参与规模、运作期、预期收益率、运作起始日等。 委托人某个开放日参与的计划份额的对应退出日为该笔份额运作起始日起满一个运作期的对日；若该日为非工作日或后续月份实际不存在对日的，则退出日顺延至下一工作日。,2、风险级份额开放期安排,管理人可以在推广时或特定开放期参与本集合计划风险级份额。管理人有权灵活设置风险级份额特定开放期。,在满足《管理合同》约定自有资金退出条件的情形下，管理人可以自行安排自有资金的退出。,管理人 	招商证券股份有限公司,托管人 	广发证券股份有限公司产品全称 	招商证券智融宝集合资产管理计划,投资范围 	本集合计划投资范围主要为伞形集合信托计划的优先级，在资金闲置期间可配置现金管理类资产等金融监管部门批准或备案发行的金融产品，以及中国证监会认可的其他投资品种。,（1）伞形集合信托计划优先级：占资产总值的 0%－100%；,（2）现金管理类资产：包括现金，存款，通知存款，大额存单，到期日在一年以内（含一年）的国债、央行票据、政策性金融债，期限在一年以内（含一年）的债券逆回购，货币市场基金以及中国证监会认可的其他现金管理类工具：占资产净值的0-100%。,管理期限 	本集合计划的存续期为3年，自本集合计划成立之日起至3年后的对应月对应日止（遇节假日或无对应日的则顺延至下一工作日）。本集合计划存续期满后，可以展期。,目标规模 	本集合计划推广期规模上限为50亿份，存续期规模上限为50亿份。推广期规模上限不含参与资金利息转增份额。,管理人有权根据实际情况调整推广期及存续期规模上限，并在管理人指定网站公告。,集合计划的总参与人数不超过200人。,份额面值 	人民币1.00元。,最低参与金额 	首次参与的最低金额为人民币100万元。管理人可以根据情况设置和调整开放日的最低参与金额，并披露。,开放期 	1、优先级份额开放期安排,开放期安排由管理人根据本集合计划的运作情况在集合计划存续期间灵活设置并确定，于当次开放期委托人参与之前由管理人披露，并披露集合计划优先级份额的期限分类（6个月1期、2期，12个月1期、2期等，以此类推）。 本集合计划可以设置多个开放日，在开放日委托人可参与本计划。委托人在某个开放日参与的计划份额，必须符合管理人在指定网站等形式披露的该份额开放日的参与条件与参与安排，参与条件与参与安排主要包括份额分类情况、份额代码、参与规模、运作期、预期收益率、运作起始日等。 委托人某个开放日参与的计划份额的对应退出日为该笔份额运作起始日起满一个运作期的对日；若该日为非工作日或后续月份实际不存在对日的，则退出日顺延至下一工作日。,2、风险级份额开放期安排,管理人可以在推广时或特定开放期参与本集合计划风险级份额。管理人有权灵活设置风险级份额特定开放期。,在满足《管理合同》约定自有资金退出条件的情形下，管理人可以自行安排自有资金的退出。,管理人 	招商证券股份有限公司,托管人 	广发证券股份有限公司";
		String strA = " ";
		String strC = " ";
		String strD = "序号发行对象申购报价（元）申购数量(万股)配售数量（万股）获配金额（万元）";
		String strE = "序号发行对象认购价格获配股数认购金额";
		String strF = "产品名称 	,,兴证资管金麒麟定享纯利集合资产管理计划,产品定位 	,,本集合计划以债券为主要投资对象，管理人通过科学合理的资产配置、券种选择、久期判断与信用分析构造债券投资组合，在优先考虑集合计划资产安全性的前提下获取长期稳健收益。,投资范围 	,,本集合计划的投资范围包括国内依法公开发行上市的国债、金融债、公司债、企业债、中小企业私募债（必须含增信措施）、可转换债券（含分离式转债）、证券投资基金、央行票据、中期票据、短期融资券、债券正回购和逆回购、债券型基金、股票型分级基金优先级份额、资产支持受益凭证、权证以及中国证监会认可的其他投资品种。,,其中：,,（1）固定收益类资产，包括国债、金融债、央行票据、企业债、公司债、中小企业私募债（必须含增信措施）、中期票据、短期融资券、资产支持受益凭证、债券型基金、股票型分级基金优先级份额、可转换债券、分离交易可转换债券、期限超过28天的债券逆回购、银行定期存款和协议存款等，投资比例为：20%-97%；其中，中小企业私募债投资比例为：0-20%，单只中小企业私募债投资比例不超过5%；投资单一债券的比例不得超过集合计划资产净值的10%，也不得超过该债券发行规模的10%；,,（2）现金类资产，包括银行活期存款、货币市场基金、期限在1年内的国债、期限在28天内的债券逆回购等，投资比例为：3%-80%；,,（3）本集合计划参与证券回购融入资金余额不得超过资产净值的40%。,,开放期规则 	,,封闭期：本集合计划自成立之日起首个封闭期为两年，在每个封闭期结束前，管理人有权公告确定下一个封闭期的起始日和结束日。,, ,,开放参与期：本集合计划每个封闭期结束日前的15个工作日管理人有权开放参与，具体开放时间由管理人公告确定；每个封闭期结束日（含）和下一个封闭期起始日（不含）之间的时间段接受委托人的参与申请，具体开放时间由管理人公告确定。管理人可根据情况提前结束产品开放参与期。,, ,,开放退出期：本集合计划每个封闭期结束日（含）和下一个封闭期起始日（不含）之间的时间段接受委托人的退出申请，具体开放时间由管理人公告确定。持有满一个封闭期的委托人也可以在封闭期内到推广网点柜台，向管理人书面提出退出申请，经管理人同意后退出本集合计划。";
		double result=SimilarDegree(strB,strF);
		if(result>=0.3){
			System.out.println("相似度很高: " +similarityResult(result)+" "+result);
		}else{
			System.out.println("相似度不高: "+similarityResult(result)+" "+result);
		}
	}


	/**
	 * 相似度转百分比
	 */

	public static String similarityResult(double resule){
		return  NumberFormat.getPercentInstance(new Locale( "en ", "US ")).format(resule);
	}

	/**
	 * 相似度比较
	 * @param strA
	 * @param strB
	 * @return
	 */

	public static double SimilarDegree(String strA, String strB){
		String newStrA = removeSign(strA);
		String newStrB = removeSign(strB);
		char[] chars_strA = newStrA.toCharArray();
		char[] chars_strB = newStrB.toCharArray();
		int m = chars_strA.length;
		int n = chars_strB.length;
		if (m<n) {
			String C = newStrA;
			newStrA = newStrB;
			newStrB = C;
		}
		int temp = Math.max(newStrA.length(), newStrB.length());
		int temp2 = longestCommonSubstring(newStrA, newStrB).length();
		return temp2 * 1.0 / temp;
	}

	private static String removeSign(String str) {
		StringBuffer sb = new StringBuffer();
		for (char item : str.toCharArray())
			if (charReg(item)){
				//System.out.println("--"+item);
				sb.append(item);
			}
		return sb.toString();
	}



	private static boolean charReg(char charValue) {
		return (charValue >= 0x4E00 && charValue <= 0X9FA5)
				|| (charValue >= 'a' && charValue <= 'z')
				|| (charValue >= 'A' && charValue <= 'Z')
				|| (charValue >= '0' && charValue <= '9');
	}



	private static String longestCommonSubstring(String strA, String strB) {
		char[] chars_strA = strA.toCharArray();
		char[] chars_strB = strB.toCharArray();
		int m = chars_strA.length;
		int n = chars_strB.length;
		
		int[][] matrix = new int[m + 1][n + 1];
		for (int i = 1; i <= m; i++) {
			for (int j = 1; j <= n; j++) {
				if (chars_strA[i - 1] == chars_strB[j - 1])
					matrix[i][j] = matrix[i - 1][j - 1] + 1;
				else
					matrix[i][j] = Math.max(matrix[i][j - 1], matrix[i - 1][j]);
			}
		}
		char[] result = new char[matrix[m][n]];
		int currentIndex = result.length - 1;
		while (matrix[m][n] != 0) {
			if (matrix[n] == matrix[n-1]){
				n--;
			}else if (matrix[m][n] == matrix[m - 1][n]) {
				m--;
			}else {
				result[currentIndex] = chars_strA[m - 1];
				currentIndex--;
				n--;
				m--;
			}
		}
		return new String(result);
	}
}